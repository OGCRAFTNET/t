<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worksheet Completer Pro</title>
    <style>
        /* ==================== VARIABLES ==================== */
        :root[data-theme="light"] {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-primary: #ffffff;
            --bg-secondary: #f1f5f9;
            --bg-tertiary: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        :root[data-theme="dark"] {
            --primary: #818cf8;
            --primary-dark: #6366f1;
            --secondary: #a78bfa;
            --success: #34d399;
            --danger: #f87171;
            --warning: #fbbf24;
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* ==================== LAYOUT ==================== */
        .app-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ==================== SIDEBAR ==================== */
        .sidebar {
            width: 320px;
            background: var(--bg-primary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, background 0.3s ease;
            z-index: 100;
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h2 {
            font-size: 18px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-icon {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            padding: 8px;
            border-radius: 8px;
        }

        .btn-icon:hover {
            background: var(--bg-secondary);
            color: var(--primary);
            transform: scale(1.1);
        }

        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .history-item {
            padding: 12px;
            margin-bottom: 8px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .history-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
            transform: translateX(5px);
        }

        .history-item.active {
            background: var(--primary);
            color: white;
        }

        .history-item-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .history-item-date {
            font-size: 12px;
            opacity: 0.7;
        }

        .history-item-preview {
            font-size: 11px;
            margin-top: 6px;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .history-btn {
            padding: 6px 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .history-item.active .history-btn {
            background: rgba(255, 255, 255, 0.3);
        }

        .history-item.active .history-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .history-btn:hover {
            transform: scale(1.05);
        }

        .history-btn.delete-btn {
            background: var(--danger);
        }

        .history-btn.delete-btn:hover {
            background: #dc2626;
        }

        .new-chat-btn {
            margin: 15px;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 15px;
        }

        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
        }

        .new-chat-btn:active {
            transform: translateY(0);
        }

        /* ==================== MAIN CONTENT ==================== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* ==================== HEADER ==================== */
        .header {
            background: var(--bg-primary);
            padding: 15px 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            transition: background 0.3s ease;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .toggle-sidebar {
            background: var(--bg-secondary);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
            color: var(--text-primary);
        }

        .toggle-sidebar:hover {
            background: var(--primary);
            color: white;
            transform: rotate(90deg);
        }

        .header-title h1 {
            font-size: 24px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-btn {
            background: var(--bg-secondary);
            border: none;
            padding: 10px 18px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .header-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* ==================== WORKSPACE ==================== */
        .workspace {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        .workspace-inner {
            max-width: 950px;
            margin: 0 auto;
        }

        /* ==================== CARDS ==================== */
        .card {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .card-icon {
            font-size: 32px;
            animation: bounce 2s ease infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* ==================== UPLOAD OPTIONS ==================== */
        .upload-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .upload-option {
            padding: 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .upload-option:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .upload-option-icon {
            font-size: 48px;
        }

        .upload-option-title {
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
        }

        .upload-option-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* ==================== UPLOAD AREA ==================== */
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 16px;
            padding: 50px 30px;
            text-align: center;
            background: var(--bg-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .upload-area.active {
            display: block;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: var(--bg-tertiary);
            transform: scale(1.02);
        }

        .upload-area.dragover {
            border-color: var(--success);
            background: var(--bg-tertiary);
            transform: scale(1.05);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .upload-text {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .upload-hint {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .file-input {
            display: none;
        }

        .file-preview {
            margin-top: 20px;
            border-radius: 16px;
            overflow: hidden;
            display: none;
            animation: zoomIn 0.3s ease;
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .file-preview img,
        .file-preview iframe {
            max-width: 100%;
            border-radius: 16px;
            border: 2px solid var(--border);
        }

        .file-preview iframe {
            width: 100%;
            height: 500px;
        }

        /* ==================== CAMERA ==================== */
        .camera-container {
            display: none;
            margin-top: 20px;
            border-radius: 16px;
            overflow: hidden;
            animation: zoomIn 0.3s ease;
        }

        .camera-container.active {
            display: block;
        }

        .camera-video {
            width: 100%;
            border-radius: 16px;
            border: 2px solid var(--primary);
            display: block;
        }

        .camera-controls {
            display: flex;
            gap: 12px;
            margin-top: 15px;
            justify-content: center;
        }

        .camera-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }

        .camera-btn.capture {
            background: var(--success);
            color: white;
        }

        .camera-btn.capture:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .camera-btn.cancel {
            background: var(--danger);
            color: white;
        }

        .camera-btn.cancel:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* ==================== MODE TABS ==================== */
        .mode-tabs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .mode-tab {
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .mode-tab:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .mode-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* ==================== INPUT FIELD ==================== */
        .input-field {
            width: 100%;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        /* ==================== MARKER CANVAS ==================== */
        .marker-canvas-container {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            display: none;
            margin-top: 15px;
            animation: fadeIn 0.3s ease;
        }

        .marker-canvas-container.active {
            display: block;
        }

        .marker-canvas {
            max-width: 100%;
            cursor: crosshair;
            border: 2px solid var(--primary);
            border-radius: 16px;
            display: block;
        }

        .marker-info {
            text-align: center;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin-top: 12px;
            font-weight: 600;
            color: var(--primary);
            display: none;
        }

        .marker-info.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .marker-controls {
            display: none;
            gap: 10px;
            margin-top: 12px;
        }

        .marker-controls.active {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        .marker-btn {
            flex: 1;
            padding: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .marker-btn:hover {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
            transform: translateY(-2px);
        }

        /* ==================== SUBMIT BUTTON ==================== */
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(99, 102, 241, 0.4);
        }

        .submit-btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ==================== MODAL ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(8px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 35px;
            max-width: 1100px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.4s ease;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
            color: var(--text-primary);
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg) scale(1.1);
        }

        /* ==================== LOADING ==================== */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-size: 20px;
            color: var(--primary);
            font-weight: 600;
        }

        /* ==================== RESULT ==================== */
        .result-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .result-section {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 16px;
        }

        .result-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-worksheet {
            background: var(--bg-primary);
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid var(--border);
        }

        .result-worksheet img {
            width: 100%;
            display: block;
        }

        .result-worksheet iframe {
            width: 100%;
            height: 600px;
            border: none;
        }

        .result-text {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid var(--primary);
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 600px;
            overflow-y: auto;
            color: var(--text-primary);
        }

        /* ==================== SETTINGS MODAL ==================== */
        .settings-content {
            max-width: 500px;
            margin: 0 auto;
        }

        .settings-content h2 {
            color: var(--primary);
            margin-bottom: 25px;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .setting-item {
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .setting-item:hover {
            background: var(--bg-tertiary);
        }

        .setting-label {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-title {
            font-weight: 700;
            font-size: 16px;
            color: var(--text-primary);
        }

        .setting-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-tertiary);
            transition: 0.4s;
            border-radius: 30px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                box-shadow: var(--shadow-lg);
            }
        }

        @media (max-width: 968px) {
            .result-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .workspace {
                padding: 20px 15px;
            }

            .card {
                padding: 20px;
            }

            .header {
                padding: 12px 15px;
            }

            .header-title h1 {
                font-size: 20px;
            }

            .mode-tabs, .upload-options {
                grid-template-columns: 1fr;
            }

            .file-preview iframe {
                height: 300px;
            }
        }

        @media (max-width: 480px) {
            .sidebar {
                width: 280px;
            }

            .header-title {
                display: none;
            }

            .modal-content {
                padding: 25px;
            }
        }

        /* ==================== SCROLLBAR ==================== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* ==================== TOAST NOTIFICATIONS ==================== */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: toastSlideIn 0.3s ease;
        }

        @keyframes toastSlideIn {
            from {
                transform: translateX(400px);
            }
            to {
                transform: translateX(0);
            }
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.info {
            border-left: 4px solid var(--primary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>📋 <span id="history-title">Verlauf</span></h2>
                <button class="btn-icon" onclick="toggleSidebar()">×</button>
            </div>
            <button class="new-chat-btn" onclick="newChat()">
                ➕ <span id="new-chat-text">Neuer Chat</span>
            </button>
            <div class="history-list" id="historyList"></div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="toggle-sidebar" onclick="toggleSidebar()">☰</button>
                    <div class="header-title">
                        <h1 id="app-title">Worksheet Completer Pro</h1>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" onclick="openSettings()">
                        ⚙️ <span id="settings-btn-text">Einstellungen</span>
                    </button>
                    <button class="header-btn" onclick="toggleLanguage()">
                        🌐 <span id="lang-btn-text">English</span>
                    </button>
                </div>
            </header>

            <div class="workspace">
                <div class="workspace-inner">
                    <!-- UPLOAD CARD -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-icon">📤</span>
                            <h2 class="card-title" id="upload-title">Arbeitsblatt hinzufügen</h2>
                        </div>

                        <!-- Upload Options -->
                        <div class="upload-options" id="uploadOptions">
                            <div class="upload-option" onclick="selectUploadMethod('file')">
                                <div class="upload-option-icon">📁</div>
                                <div class="upload-option-title" id="option-file-title">Datei hochladen</div>
                                <div class="upload-option-desc" id="option-file-desc">PDF oder Bild auswählen</div>
                            </div>
                            <div class="upload-option" onclick="selectUploadMethod('camera')">
                                <div class="upload-option-icon">📸</div>
                                <div class="upload-option-title" id="option-camera-title">Foto aufnehmen</div>
                                <div class="upload-option-desc" id="option-camera-desc">Mit Kamera fotografieren</div>
                            </div>
                        </div>

                        <!-- File Upload Area -->
                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                            <div class="upload-icon">📄</div>
                            <div class="upload-text" id="upload-text">Datei hochladen</div>
                            <div class="upload-hint" id="upload-hint">PDF oder Bild - Drag & Drop unterstützt</div>
                        </div>
                        <input type="file" id="fileInput" class="file-input" accept="image/*,application/pdf" onchange="handleFileSelect(event)">

                        <!-- Camera Container -->
                        <div class="camera-container" id="cameraContainer">
                            <video id="cameraVideo" class="camera-video" autoplay playsinline></video>
                            <div class="camera-controls">
                                <button class="camera-btn capture" onclick="capturePhoto()">
                                    📸 <span id="btn-capture-text">Foto aufnehmen</span>
                                </button>
                                <button class="camera-btn cancel" onclick="stopCamera()">
                                    ✖️ <span id="btn-cancel-text">Abbrechen</span>
                                </button>
                            </div>
                        </div>

                        <!-- File Preview -->
                        <div class="file-preview" id="filePreview"></div>
                    </div>

                    <!-- SELECTION CARD -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-icon">🎯</span>
                            <h2 class="card-title" id="selection-title">Aufgaben auswählen</h2>
                        </div>
                        
                        <div class="mode-tabs">
                            <div class="mode-tab active" onclick="switchMode('numbers')" id="tab-numbers">
                                <span>🔢</span> <span id="tab-numbers-text">Nummern eingeben</span>
                            </div>
                            <div class="mode-tab" onclick="switchMode('marker')" id="tab-marker">
                                <span>✏️</span> <span id="tab-marker-text">Bereiche markieren</span>
                            </div>
                        </div>

                        <div class="mode-content active" id="mode-numbers">
                            <input type="text" class="input-field" id="numberInput" placeholder="z.B. 1, 3, 5, 7-10 oder Aufgabe 1a, 2b">
                        </div>

                        <div class="mode-content" id="mode-marker">
                            <div class="marker-canvas-container" id="markerContainer">
                                <canvas id="markerCanvas" class="marker-canvas"></canvas>
                            </div>
                            <div class="marker-info" id="marker-info">
                                📍 <span id="marker-count">0</span> <span id="marker-count-text">Markierungen</span>
                            </div>
                            <div class="marker-controls" id="marker-controls">
                                <button class="marker-btn" onclick="clearLastMarker()">
                                    ↩️ <span id="btn-undo-text">Letzte löschen</span>
                                </button>
                                <button class="marker-btn" onclick="clearAllMarkers()">
                                    🗑️ <span id="btn-clear-text">Alle löschen</span>
                                </button>
                            </div>
                        </div>

                        <button class="submit-btn" id="submitBtn" onclick="completeWorksheet()" disabled>
                            <span>✨</span> <span id="submit-text">Jetzt vervollständigen</span>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">×</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
 const _0x469e95=_0x5389;(function(_0x124d8b,_0x13da05){const _0x12abb9=_0x5389,_0x25c112=_0x124d8b();while(!![]){try{const _0x3b653a=-parseInt(_0x12abb9(0x1d5))/0x1+-parseInt(_0x12abb9(0x12b))/0x2*(-parseInt(_0x12abb9(0x187))/0x3)+parseInt(_0x12abb9(0x17f))/0x4+parseInt(_0x12abb9(0x1e4))/0x5*(-parseInt(_0x12abb9(0x1dd))/0x6)+-parseInt(_0x12abb9(0x145))/0x7*(-parseInt(_0x12abb9(0x1a6))/0x8)+parseInt(_0x12abb9(0x1b8))/0x9+-parseInt(_0x12abb9(0x113))/0xa*(parseInt(_0x12abb9(0x156))/0xb);if(_0x3b653a===_0x13da05)break;else _0x25c112['push'](_0x25c112['shift']());}catch(_0x126725){_0x25c112['push'](_0x25c112['shift']());}}}(_0x5530,0x5d034));const translations={'de':{'appTitle':_0x469e95(0x1cc),'historyTitle':'Verlauf','newChat':'Neuer\x20Chat','settingsBtn':_0x469e95(0x1a2),'langBtn':_0x469e95(0x105),'uploadTitle':_0x469e95(0x197),'optionFileTitle':_0x469e95(0x1be),'optionFileDesc':_0x469e95(0x11a),'optionCameraTitle':_0x469e95(0x106),'optionCameraDesc':_0x469e95(0x1e8),'uploadText':'Datei\x20hochladen','uploadHint':'PDF\x20oder\x20Bild\x20-\x20Drag\x20&\x20Drop\x20unterstützt','selectionTitle':'Aufgaben\x20auswählen','tabNumbers':'Nummern\x20eingeben','tabMarker':'Bereiche\x20markieren','numberPlaceholder':'z.B.\x201,\x203,\x205,\x207-10\x20oder\x20Aufgabe\x201a,\x202b','markerCountText':_0x469e95(0x152),'btnUndo':_0x469e95(0x1dc),'btnClear':_0x469e95(0x16b),'btnCapture':'Foto\x20aufnehmen','btnCancel':_0x469e95(0x1a4),'submitText':_0x469e95(0x1c7),'loadingText':_0x469e95(0x134),'worksheetTitle':_0x469e95(0x15e),'solutionsTitle':'Lösungen','errorTitle':'Fehler','noFile':'Bitte\x20lade\x20zuerst\x20eine\x20Datei\x20hoch.','noSelection':_0x469e95(0xf4),'errorMsg':_0x469e95(0x10f),'cameraError':_0x469e95(0x141),'viewBtn':_0x469e95(0x1d7),'deleteBtn':_0x469e95(0x1c0),'confirmDelete':_0x469e95(0x1c5),'settingsTitle':_0x469e95(0x1a2),'darkModeTitle':_0x469e95(0x144),'darkModeDesc':_0x469e95(0x1e6),'newChatToast':_0x469e95(0x11c),'chatDeletedToast':_0x469e95(0x1f2),'fileUploadedToast':_0x469e95(0x1eb),'photoTakenToast':'Foto\x20aufgenommen'},'en':{'appTitle':_0x469e95(0x1cc),'historyTitle':_0x469e95(0x11d),'newChat':_0x469e95(0xde),'settingsBtn':_0x469e95(0x12a),'langBtn':_0x469e95(0xd8),'uploadTitle':_0x469e95(0x15a),'optionFileTitle':_0x469e95(0x112),'optionFileDesc':_0x469e95(0xf3),'optionCameraTitle':'Take\x20Photo','optionCameraDesc':_0x469e95(0x196),'uploadText':'Upload\x20File','uploadHint':_0x469e95(0x1aa),'selectionTitle':_0x469e95(0xdd),'tabNumbers':'Enter\x20Numbers','tabMarker':_0x469e95(0x1c4),'numberPlaceholder':'e.g.\x201,\x203,\x205,\x207-10\x20or\x20Task\x201a,\x202b','markerCountText':_0x469e95(0x1b1),'btnUndo':'Delete\x20last','btnClear':'Delete\x20all','btnCapture':_0x469e95(0x108),'btnCancel':_0x469e95(0x1db),'submitText':_0x469e95(0x190),'loadingText':_0x469e95(0xe2),'worksheetTitle':'Worksheet','solutionsTitle':_0x469e95(0x124),'errorTitle':'Error','noFile':_0x469e95(0x15c),'noSelection':_0x469e95(0x123),'errorMsg':'An\x20error\x20occurred.\x20Please\x20try\x20again.','cameraError':_0x469e95(0x153),'viewBtn':_0x469e95(0x1e2),'deleteBtn':_0x469e95(0xdf),'confirmDelete':_0x469e95(0x185),'settingsTitle':_0x469e95(0x12a),'darkModeTitle':_0x469e95(0x144),'darkModeDesc':_0x469e95(0x116),'newChatToast':_0x469e95(0x14e),'chatDeletedToast':_0x469e95(0x172),'fileUploadedToast':_0x469e95(0xfc),'photoTakenToast':_0x469e95(0x1f5)}};let currentLang='de',currentChatId=null,uploadedFile=null,uploadedFileBase64=null,uploadedFileType=null,currentMode=_0x469e95(0x154),markedAreas=[],isDrawing=![],startX,startY,chatHistory=[],darkMode=localStorage[_0x469e95(0x19e)](_0x469e95(0x19a))===_0x469e95(0x1f3),cameraStream=null;function init(){const _0x524f00=_0x469e95;loadChatHistory(),applyDarkMode(),updateUI(),chatHistory[_0x524f00(0x1f4)]===0x0&&newChat();}function applyDarkMode(){const _0x19b65f=_0x469e95;document[_0x19b65f(0x17c)][_0x19b65f(0x1cf)](_0x19b65f(0x100),darkMode?'dark':_0x19b65f(0x1e9));}function toggleDarkMode(){const _0x45c64e=_0x469e95;darkMode=!darkMode,localStorage[_0x45c64e(0x162)](_0x45c64e(0x19a),darkMode),applyDarkMode();}function toggleLanguage(){currentLang=currentLang==='de'?'en':'de',updateUI(),renderHistory();}function updateUI(){const _0x4f33e1=_0x469e95,_0x131817=translations[currentLang];document[_0x4f33e1(0x1ff)](_0x4f33e1(0x13d))[_0x4f33e1(0x1a5)]=_0x131817['appTitle'],document[_0x4f33e1(0x1ff)](_0x4f33e1(0x178))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x17b)],document['getElementById']('new-chat-text')[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0xdc)],document['getElementById'](_0x4f33e1(0x1c6))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x1c3)],document[_0x4f33e1(0x1ff)](_0x4f33e1(0xed))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0xf5)],document['getElementById'](_0x4f33e1(0x1f9))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x10d)],document[_0x4f33e1(0x1ff)]('option-file-title')['textContent']=_0x131817['optionFileTitle'],document[_0x4f33e1(0x1ff)](_0x4f33e1(0x1c9))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0xf1)],document[_0x4f33e1(0x1ff)](_0x4f33e1(0x1ec))[_0x4f33e1(0x1a5)]=_0x131817['optionCameraTitle'],document[_0x4f33e1(0x1ff)](_0x4f33e1(0x17a))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x16d)],document['getElementById'](_0x4f33e1(0x1cb))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x143)],document[_0x4f33e1(0x1ff)](_0x4f33e1(0x1e5))['textContent']=_0x131817['uploadHint'],document['getElementById'](_0x4f33e1(0x171))[_0x4f33e1(0x1a5)]=_0x131817['selectionTitle'],document[_0x4f33e1(0x1ff)](_0x4f33e1(0x1fa))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x170)],document[_0x4f33e1(0x1ff)](_0x4f33e1(0xdb))['textContent']=_0x131817['tabMarker'],document[_0x4f33e1(0x1ff)]('numberInput')[_0x4f33e1(0x1ba)]=_0x131817[_0x4f33e1(0x18c)],document[_0x4f33e1(0x1ff)]('marker-count-text')[_0x4f33e1(0x1a5)]=_0x131817['markerCountText'],document[_0x4f33e1(0x1ff)](_0x4f33e1(0xeb))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x1b4)],document[_0x4f33e1(0x1ff)](_0x4f33e1(0x1ea))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x128)],document['getElementById'](_0x4f33e1(0x199))['textContent']=_0x131817['btnCapture'],document['getElementById'](_0x4f33e1(0x149))[_0x4f33e1(0x1a5)]=_0x131817[_0x4f33e1(0x163)],document[_0x4f33e1(0x1ff)](_0x4f33e1(0x127))['textContent']=_0x131817[_0x4f33e1(0x1a1)];}function toggleSidebar(){const _0x421e73=_0x469e95;document[_0x421e73(0x1ff)](_0x421e73(0x10c))[_0x421e73(0x1fc)]['toggle'](_0x421e73(0x192));}function loadChatHistory(){const _0x194ecf=_0x469e95,_0x14a89c=localStorage[_0x194ecf(0x19e)](_0x194ecf(0x161));chatHistory=_0x14a89c?JSON[_0x194ecf(0xe1)](_0x14a89c):[],renderHistory();}function saveChatHistory(){const _0x46ba04=_0x469e95;localStorage[_0x46ba04(0x162)](_0x46ba04(0x161),JSON[_0x46ba04(0x14a)](chatHistory)),renderHistory();}function renderHistory(){const _0x401cbf=_0x469e95,_0x75628f=translations[currentLang],_0x14600b=document[_0x401cbf(0x1ff)](_0x401cbf(0x1b7));_0x14600b['innerHTML']='';if(chatHistory['length']===0x0){_0x14600b[_0x401cbf(0x1fe)]='<div\x20style=\x22text-align:center;padding:20px;color:var(--text-secondary);\x22>Kein\x20Verlauf</div>';return;}chatHistory['forEach'](_0x35ba1a=>{const _0x192042=_0x401cbf,_0x4b2fb4=document[_0x192042(0x140)]('div');_0x4b2fb4[_0x192042(0x11f)]='history-item'+(_0x35ba1a['id']===currentChatId?_0x192042(0x167):'');const _0x3d327f=_0x35ba1a[_0x192042(0x10b)]?_0x35ba1a['result']['substring'](0x0,0x32)[_0x192042(0xff)](/\n/g,'\x20')+_0x192042(0x182):'';_0x4b2fb4[_0x192042(0x1fe)]=_0x192042(0x13e)+(_0x35ba1a[_0x192042(0xe9)]||'Unbenannt')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-item-date\x22>'+new Date(_0x35ba1a['date'])[_0x192042(0x12e)](_0x192042(0xf0),{'day':_0x192042(0x13c),'month':_0x192042(0x13c),'year':_0x192042(0x1ad),'hour':_0x192042(0x13c),'minute':'2-digit'})+_0x192042(0x160)+_0x3d327f+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22history-btn\x22\x20data-chat-id=\x22'+_0x35ba1a['id']+_0x192042(0x191)+_0x75628f[_0x192042(0x186)]+_0x192042(0x138)+_0x35ba1a['id']+_0x192042(0x1bc)+_0x75628f['deleteBtn']+_0x192042(0xf9);const _0x4ecfed=_0x4b2fb4['querySelector']('[data-action=\x22view\x22]'),_0x22d3a4=_0x4b2fb4[_0x192042(0x14c)]('[data-action=\x22delete\x22]');_0x4ecfed['addEventListener'](_0x192042(0xd7),_0x7cc1b=>{const _0x5c38e1=_0x192042;_0x7cc1b[_0x5c38e1(0xf7)](),viewChat(_0x35ba1a['id']);}),_0x22d3a4['addEventListener'](_0x192042(0xd7),_0xf6d8d9=>{const _0x18571e=_0x192042;_0xf6d8d9[_0x18571e(0xf7)](),deleteChat(_0x35ba1a['id']);}),_0x14600b[_0x192042(0x1ee)](_0x4b2fb4);});}function newChat(){const _0x5003aa=_0x469e95;currentChatId=_0x5003aa(0x1ed)+Date[_0x5003aa(0x180)](),uploadedFile=null,uploadedFileBase64=null,uploadedFileType=null,markedAreas=[],document[_0x5003aa(0x1ff)](_0x5003aa(0x184))[_0x5003aa(0x1b5)]['display']='grid',document['getElementById'](_0x5003aa(0xf8))[_0x5003aa(0x1fc)][_0x5003aa(0x130)](_0x5003aa(0x101)),document['getElementById']('cameraContainer')[_0x5003aa(0x1fc)][_0x5003aa(0x130)](_0x5003aa(0x101));const _0x6a6a7=document[_0x5003aa(0x1ff)](_0x5003aa(0x11b));_0x6a6a7[_0x5003aa(0x1b5)][_0x5003aa(0x155)]='none',_0x6a6a7[_0x5003aa(0x1fe)]='';const _0x201ede=document[_0x5003aa(0x1ff)](_0x5003aa(0xef));_0x201ede[_0x5003aa(0x1fc)]['remove'](_0x5003aa(0x101)),_0x201ede[_0x5003aa(0x1b5)][_0x5003aa(0x155)]=_0x5003aa(0x19d),document['getElementById'](_0x5003aa(0xe3))['value']='',document[_0x5003aa(0x1ff)](_0x5003aa(0x16f))[_0x5003aa(0x115)]='',document['getElementById'](_0x5003aa(0x147))[_0x5003aa(0x119)]=!![],stopCamera(),updateMarkerCount(),renderHistory(),showToast(translations[currentLang][_0x5003aa(0x1a8)],_0x5003aa(0x1c1)),window['innerWidth']<=0x400&&document[_0x5003aa(0x1ff)](_0x5003aa(0x10c))['classList']['add'](_0x5003aa(0x192));}function viewChat(_0x4944c3){const _0x5b7f4e=_0x469e95,_0x142e8e=chatHistory[_0x5b7f4e(0x132)](_0x12a0bc=>_0x12a0bc['id']===_0x4944c3);if(!_0x142e8e)return;currentChatId=_0x4944c3,showResultModal(_0x142e8e[_0x5b7f4e(0x10b)],_0x142e8e['fileBase64'],_0x142e8e[_0x5b7f4e(0x1cd)],_0x142e8e[_0x5b7f4e(0xe9)]),renderHistory(),window[_0x5b7f4e(0x1ef)]<=0x400&&document[_0x5b7f4e(0x1ff)](_0x5b7f4e(0x10c))[_0x5b7f4e(0x1fc)][_0x5b7f4e(0xf6)](_0x5b7f4e(0x192));}function deleteChat(_0x3fbe5c){const _0x24813e=_0x469e95,_0x55edc0=translations[currentLang];confirm(_0x55edc0[_0x24813e(0x16c)])&&(chatHistory=chatHistory['filter'](_0x3d31b6=>_0x3d31b6['id']!==_0x3fbe5c),saveChatHistory(),showToast(_0x55edc0['chatDeletedToast'],_0x24813e(0x18b)),currentChatId===_0x3fbe5c&&newChat());}function selectUploadMethod(_0x4137d3){const _0x546636=_0x469e95;document[_0x546636(0x1ff)](_0x546636(0x184))[_0x546636(0x1b5)][_0x546636(0x155)]=_0x546636(0x19d);if(_0x4137d3===_0x546636(0x10e))document[_0x546636(0x1ff)](_0x546636(0xf8))[_0x546636(0x1fc)][_0x546636(0xf6)](_0x546636(0x101));else _0x4137d3===_0x546636(0xd6)&&startCamera();}async function startCamera(){const _0x549607=_0x469e95,_0x2b584f=translations[currentLang];try{cameraStream=await navigator[_0x549607(0x17d)][_0x549607(0x10a)]({'video':{'facingMode':_0x549607(0x142),'width':{'ideal':0x780},'height':{'ideal':0x438}}});const _0x5d7d19=document['getElementById'](_0x549607(0x169));_0x5d7d19[_0x549607(0xea)]=cameraStream,document['getElementById'](_0x549607(0x1f6))['classList'][_0x549607(0xf6)](_0x549607(0x101));}catch(_0xe9da1c){console[_0x549607(0x13f)](_0x549607(0x19c),_0xe9da1c),showToast(_0x2b584f[_0x549607(0xe0)],_0x549607(0x13f)),document[_0x549607(0x1ff)](_0x549607(0x184))[_0x549607(0x1b5)][_0x549607(0x155)]=_0x549607(0x118);}}function stopCamera(){const _0x218aa9=_0x469e95;cameraStream&&(cameraStream['getTracks']()['forEach'](_0x57a481=>_0x57a481[_0x218aa9(0x1af)]()),cameraStream=null),document['getElementById'](_0x218aa9(0x1f6))[_0x218aa9(0x1fc)][_0x218aa9(0x130)](_0x218aa9(0x101)),document['getElementById'](_0x218aa9(0x184))['style']['display']=_0x218aa9(0x118);}function capturePhoto(){const _0x361845=_0x469e95,_0x26ca8a=document[_0x361845(0x1ff)]('cameraVideo'),_0x5675df=document[_0x361845(0x140)](_0x361845(0x16e));_0x5675df[_0x361845(0x12f)]=_0x26ca8a['videoWidth'],_0x5675df['height']=_0x26ca8a['videoHeight'];const _0x9f166e=_0x5675df[_0x361845(0x148)]('2d');_0x9f166e[_0x361845(0x125)](_0x26ca8a,0x0,0x0),_0x5675df[_0x361845(0x193)](_0x5a59ba=>{const _0xdebe53=_0x361845,_0x59f6e3=new File([_0x5a59ba],_0xdebe53(0x12c)+Date[_0xdebe53(0x180)]()+_0xdebe53(0xda),{'type':_0xdebe53(0x15b)});processFile(_0x59f6e3),stopCamera(),showToast(translations[currentLang][_0xdebe53(0x121)],_0xdebe53(0x18b));},_0x361845(0x15b),0.95);}const uploadArea=document[_0x469e95(0x1ff)]('uploadArea'),fileInput=document[_0x469e95(0x1ff)]('fileInput'),filePreview=document[_0x469e95(0x1ff)]('filePreview');uploadArea[_0x469e95(0x131)](_0x469e95(0x1d4),_0x5ad22d=>{const _0x5b418f=_0x469e95;_0x5ad22d['preventDefault'](),uploadArea[_0x5b418f(0x1fc)][_0x5b418f(0xf6)](_0x5b418f(0x1d4));}),uploadArea[_0x469e95(0x131)](_0x469e95(0x1d9),()=>{const _0x2fc8fd=_0x469e95;uploadArea[_0x2fc8fd(0x1fc)][_0x2fc8fd(0x130)](_0x2fc8fd(0x1d4));}),uploadArea['addEventListener'](_0x469e95(0xe7),_0x7c77f1=>{const _0x25c3df=_0x469e95;_0x7c77f1['preventDefault'](),uploadArea[_0x25c3df(0x1fc)][_0x25c3df(0x130)](_0x25c3df(0x1d4));const _0x274028=_0x7c77f1['dataTransfer']['files'][0x0];if(_0x274028)processFile(_0x274028);});function handleFileSelect(_0x33bd4a){const _0x3b389d=_0x469e95,_0x4b1984=_0x33bd4a['target'][_0x3b389d(0x104)][0x0];if(_0x4b1984)processFile(_0x4b1984);}async function processFile(_0x582255){const _0x8af7f=_0x469e95;uploadedFile=_0x582255,uploadedFileType=_0x582255[_0x8af7f(0x179)],uploadedFileBase64=await fileToBase64(_0x582255),filePreview[_0x8af7f(0x1fe)]='';if(_0x582255[_0x8af7f(0x179)][_0x8af7f(0x174)]('image/')){const _0x2d6de9=document[_0x8af7f(0x140)](_0x8af7f(0x15f));_0x2d6de9['src']=uploadedFileBase64,_0x2d6de9[_0x8af7f(0x17e)]=()=>{const _0x38718b=_0x8af7f;filePreview[_0x38718b(0x1ee)](_0x2d6de9),filePreview['style'][_0x38718b(0x155)]=_0x38718b(0x1a7),setupMarkerCanvas(_0x2d6de9);};}else{if(_0x582255['type']===_0x8af7f(0x16a)){const _0x12b0c2=document[_0x8af7f(0x140)](_0x8af7f(0x1f1));_0x12b0c2[_0x8af7f(0x1e0)]=uploadedFileBase64,filePreview[_0x8af7f(0x1ee)](_0x12b0c2),filePreview[_0x8af7f(0x1b5)][_0x8af7f(0x155)]=_0x8af7f(0x1a7);}}document['getElementById'](_0x8af7f(0x147))[_0x8af7f(0x119)]=![],showToast(translations[currentLang]['fileUploadedToast'],'success');}function switchMode(_0x511de4){const _0x37b169=_0x469e95;currentMode=_0x511de4,document[_0x37b169(0x1a3)]('.mode-tab')[_0x37b169(0x110)](_0x23c816=>_0x23c816[_0x37b169(0x1fc)][_0x37b169(0x130)](_0x37b169(0x101))),document[_0x37b169(0x1ff)](_0x37b169(0x175)+_0x511de4)[_0x37b169(0x1fc)][_0x37b169(0xf6)](_0x37b169(0x101)),document['querySelectorAll'](_0x37b169(0x1bb))[_0x37b169(0x110)](_0x46e70f=>_0x46e70f[_0x37b169(0x1fc)][_0x37b169(0x130)](_0x37b169(0x101))),document['getElementById'](_0x37b169(0x1de)+_0x511de4)[_0x37b169(0x1fc)]['add'](_0x37b169(0x101));}function setupMarkerCanvas(_0x2b8464){const _0x11396e=_0x469e95,_0x52a7c2=document[_0x11396e(0x1ff)](_0x11396e(0x1ab)),_0x40535f=document['getElementById'](_0x11396e(0xef)),_0x405ee6=_0x52a7c2['getContext']('2d');_0x52a7c2[_0x11396e(0x12f)]=_0x2b8464['naturalWidth'],_0x52a7c2[_0x11396e(0x1bd)]=_0x2b8464[_0x11396e(0x117)],_0x405ee6[_0x11396e(0x125)](_0x2b8464,0x0,0x0),_0x40535f[_0x11396e(0x1fc)]['add'](_0x11396e(0x101)),_0x40535f[_0x11396e(0x1b5)]['display']=_0x11396e(0x1a7),markedAreas=[],updateMarkerCount();const _0x4cc781=_0x52a7c2[_0x11396e(0x139)](!![]);_0x52a7c2[_0x11396e(0x1c8)][_0x11396e(0x1ca)](_0x4cc781,_0x52a7c2);const _0x422a98=document['getElementById'](_0x11396e(0x1ab)),_0x3cb490=_0x422a98[_0x11396e(0x148)]('2d');_0x3cb490[_0x11396e(0x125)](_0x2b8464,0x0,0x0),_0x422a98[_0x11396e(0x131)]('mousedown',startDrawing),_0x422a98[_0x11396e(0x131)](_0x11396e(0xec),draw),_0x422a98[_0x11396e(0x131)](_0x11396e(0xe5),stopDrawing),_0x422a98[_0x11396e(0x131)](_0x11396e(0x1df),stopDrawing),_0x422a98['addEventListener'](_0x11396e(0x114),handleTouchStart),_0x422a98[_0x11396e(0x131)](_0x11396e(0xd9),handleTouchMove),_0x422a98[_0x11396e(0x131)](_0x11396e(0xfb),stopDrawing),_0x422a98[_0x11396e(0x131)]('contextmenu',handleRightClick);}function redrawCanvas(){const _0x1f761a=_0x469e95,_0x4f2c42=document[_0x1f761a(0x1ff)](_0x1f761a(0x1ab)),_0x335052=_0x4f2c42[_0x1f761a(0x148)]('2d'),_0x1ac374=filePreview[_0x1f761a(0x14c)](_0x1f761a(0x15f));if(!_0x1ac374)return;_0x335052[_0x1f761a(0xd5)](0x0,0x0,_0x4f2c42['width'],_0x4f2c42['height']),_0x335052[_0x1f761a(0x125)](_0x1ac374,0x0,0x0),markedAreas[_0x1f761a(0x110)](_0x4a26bd=>{const _0x14d72d=_0x1f761a;_0x335052[_0x14d72d(0x1e3)]=_0x14d72d(0x1a9),_0x335052['fillStyle']=_0x14d72d(0x1a0),_0x335052['lineWidth']=0x3,_0x335052[_0x14d72d(0x1c2)](_0x4a26bd['x'],_0x4a26bd['y'],_0x4a26bd[_0x14d72d(0x12f)],_0x4a26bd[_0x14d72d(0x1bd)]),_0x335052[_0x14d72d(0x14f)](_0x4a26bd['x'],_0x4a26bd['y'],_0x4a26bd['width'],_0x4a26bd['height']);});}function startDrawing(_0x113fff){const _0x4e7369=_0x469e95;isDrawing=!![];const _0x348737=_0x113fff[_0x4e7369(0x1da)][_0x4e7369(0x13a)](),_0x574b24=_0x113fff[_0x4e7369(0x1da)]['width']/_0x348737[_0x4e7369(0x12f)],_0x88a4e=_0x113fff[_0x4e7369(0x1da)][_0x4e7369(0x1bd)]/_0x348737[_0x4e7369(0x1bd)];startX=(_0x113fff[_0x4e7369(0x1b2)]-_0x348737['left'])*_0x574b24,startY=(_0x113fff['clientY']-_0x348737[_0x4e7369(0xe4)])*_0x88a4e;}function draw(_0xd67685){const _0x20e107=_0x469e95;if(!isDrawing)return;const _0x3d213b=document[_0x20e107(0x1ff)](_0x20e107(0x1ab)),_0x48e2f9=_0x3d213b['getContext']('2d'),_0x29ec42=_0xd67685[_0x20e107(0x1da)][_0x20e107(0x13a)](),_0xe8b3f8=_0xd67685[_0x20e107(0x1da)][_0x20e107(0x12f)]/_0x29ec42[_0x20e107(0x12f)],_0x54e8ed=_0xd67685[_0x20e107(0x1da)]['height']/_0x29ec42[_0x20e107(0x1bd)],_0x5d3508=(_0xd67685['clientX']-_0x29ec42[_0x20e107(0x1d3)])*_0xe8b3f8,_0x2b74e2=(_0xd67685['clientY']-_0x29ec42[_0x20e107(0xe4)])*_0x54e8ed;redrawCanvas();const _0x5928ba=_0x5d3508-startX,_0x29309d=_0x2b74e2-startY;_0x48e2f9[_0x20e107(0x1e3)]=_0x20e107(0x1a9),_0x48e2f9[_0x20e107(0x194)]='rgba(99,\x20102,\x20241,\x200.2)',_0x48e2f9[_0x20e107(0x151)]=0x3,_0x48e2f9[_0x20e107(0x1c2)](startX,startY,_0x5928ba,_0x29309d),_0x48e2f9[_0x20e107(0x14f)](startX,startY,_0x5928ba,_0x29309d);}function stopDrawing(_0xc17c59){const _0x40f1ce=_0x469e95;if(!isDrawing)return;isDrawing=![];const _0x22191d=document[_0x40f1ce(0x1ff)](_0x40f1ce(0x1ab)),_0x2b1cee=_0xc17c59[_0x40f1ce(0x1da)]['getBoundingClientRect'](),_0x39c787=_0x22191d[_0x40f1ce(0x12f)]/_0x2b1cee[_0x40f1ce(0x12f)],_0x12cf7e=_0x22191d[_0x40f1ce(0x1bd)]/_0x2b1cee[_0x40f1ce(0x1bd)],_0x4598ab=(_0xc17c59['clientX']-_0x2b1cee[_0x40f1ce(0x1d3)])*_0x39c787,_0x4d32e3=(_0xc17c59['clientY']-_0x2b1cee[_0x40f1ce(0xe4)])*_0x12cf7e,_0x52e4fa=_0x4598ab-startX,_0x4fd670=_0x4d32e3-startY;Math['abs'](_0x52e4fa)>0xa&&Math[_0x40f1ce(0x1b9)](_0x4fd670)>0xa&&(markedAreas[_0x40f1ce(0x168)]({'x':Math[_0x40f1ce(0x157)](startX,_0x4598ab),'y':Math[_0x40f1ce(0x157)](startY,_0x4d32e3),'width':Math[_0x40f1ce(0x1b9)](_0x52e4fa),'height':Math[_0x40f1ce(0x1b9)](_0x4fd670)}),updateMarkerCount(),redrawCanvas());}function _0x5530(){const _0x3ac9a8=['cameraContainer','unshift','Keine\x20Lösungen\x20verfügbar','upload-title','tab-numbers-text','<img\x20src=\x22','classList','href','innerHTML','getElementById','clearRect','camera','click','Deutsch','touchmove','.jpg','tab-marker-text','newChat','Select\x20Tasks','New\x20Chat','Delete','cameraError','parse','Analyzing\x20worksheet...','numberInput','top','mouseup','dispatchEvent','drop','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','filename','srcObject','btn-undo-text','mousemove','lang-btn-text','darkModeDesc','markerContainer','de-DE','optionFileDesc','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>','Select\x20PDF\x20or\x20image','Bitte\x20wähle\x20Aufgaben\x20aus.','langBtn','add','stopPropagation','uploadArea','</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','touchend','File\x20uploaded','marker-info','darkModeTitle','replace','data-theme','active','google/gemma-3-27b-it:free','Solve\x20these\x20tasks:\x20','files','English','Foto\x20aufnehmen','\x22></iframe>','Take\x20Photo','findIndex','getUserMedia','result','sidebar','uploadTitle','file','Ein\x20Fehler\x20ist\x20aufgetreten.\x20Bitte\x20versuche\x20es\x20erneut.','forEach','solutionsTitle','Upload\x20File','245610hdlbES','touchstart','value','Enable\x20dark\x20theme','naturalHeight','grid','disabled','PDF\x20oder\x20Bild\x20auswählen','filePreview','Neuer\x20Chat\x20erstellt','History','content','className','noFile','photoTakenToast','splice','Please\x20select\x20tasks.','Solutions','drawImage','\x22\x20alt=\x22','submit-text','btnClear','errorMsg','Settings','4AAEzlA','foto_','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','toLocaleString','width','remove','addEventListener','find','image_url','Analysiere\x20Arbeitsblatt...','text','marker-controls','\x0a\x0aFORMATTING:\x0a-\x20Use\x20EXACT\x20numbering\x20from\x20worksheet\x0a-\x20Format:\x20\x22Task\x201)\x20a)\x20b)\x22\x20or\x20\x221.\x202.\x203.\x22\x0a-\x20ONLY\x20direct\x20answers\x20-\x20NO\x20explanations\x0a-\x20NO\x20introductory\x20sentences\x0a-\x20Follow\x20task\x20structure\x20precisely\x0a\x0aEXAMPLE:\x0aWorksheet:\x20\x22Task\x201)\x20a)\x205+3?\x20b)\x2010-4?\x22\x0aAnswer:\x20\x22Task\x201)\x20a)\x208\x20b)\x206\x22','</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22history-btn\x20delete-btn\x22\x20data-chat-id=\x22','cloneNode','getBoundingClientRect','Löse\x20folgende\x20Aufgaben:\x20','2-digit','app-title','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-item-title\x22>📄\x20','error','createElement','Kamera\x20konnte\x20nicht\x20gestartet\x20werden.\x20Bitte\x20überprüfe\x20die\x20Berechtigungen.','environment','uploadText','Dark\x20Mode','52661hbnEYR','worksheetTitle','submitBtn','getContext','btn-cancel-text','stringify','json','querySelector','alle\x20markierten\x20Bereiche','New\x20chat\x20created','fillRect','name','lineWidth','Markierungen','Could\x20not\x20start\x20camera.\x20Please\x20check\x20permissions.','numbers','display','165RdCYzn','min','body','toISOString','Add\x20Worksheet','image/jpeg','Please\x20upload\x20a\x20file\x20first.','toastSlideIn\x200.3s\x20ease\x20reverse','Arbeitsblatt','img','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22history-item-preview\x22>','worksheetHistory','setItem','btnCancel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22result-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22result-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>📄\x20','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22toggle-switch\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20','modal','\x20active','push','cameraVideo','application/pdf','Alle\x20löschen','confirmDelete','optionCameraDesc','canvas','fileInput','tabNumbers','selection-title','Chat\x20deleted','</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-item\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-title\x22>','startsWith','tab-','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22result-text\x22>','choices','history-title','type','option-camera-desc','historyTitle','documentElement','mediaDevices','onload','2852312NJhsgJ','now','animation','...','POST','uploadOptions','Really\x20delete\x20chat?','viewBtn','802428DxTDsm','settingsTitle','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22spinner\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22loading-text\x22>','mousedown','success','numberPlaceholder','application/json','preventDefault','</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Complete\x20Now','\x22\x20data-action=\x22view\x22>👁️\x20','collapsed','toBlob','fillStyle','Worksheet','Capture\x20with\x20camera','Arbeitsblatt\x20hinzufügen','<iframe\x20src=\x22','btn-capture-text','darkMode','<div\x20style=\x22padding:20px;text-align:center;color:var(--text-secondary);\x22>Keine\x20Vorschau\x20verfügbar</div>','Camera\x20error:','none','getItem','modalBody','rgba(99,\x20102,\x20241,\x200.2)','submitText','Einstellungen','querySelectorAll','Abbrechen','textContent','488WDZnie','block','newChatToast','rgba(99,\x20102,\x20241,\x200.8)','PDF\x20or\x20Image\x20-\x20Drag\x20&\x20Drop\x20supported','markerCanvas','user','numeric','</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22result-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>✅\x20','stop','trim','Marks','clientX','</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22result-worksheet\x22>','btnUndo','style','clientY','historyList','3454740YRWBjn','abs','placeholder','.mode-content','\x22\x20data-action=\x22delete\x22>🗑️\x20','height','Datei\x20hochladen','div','Löschen','info','strokeRect','settingsBtn','Mark\x20Areas','Chat\x20wirklich\x20löschen?','settings-btn-text','Jetzt\x20vervollständigen','parentNode','option-file-desc','replaceChild','upload-text','Worksheet\x20Completer\x20Pro','fileType','noSelection','setAttribute','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22settings-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2>⚙️\x20','Error:','image/','left','dragover','721852PocaVp','touches','Ansehen','checked','dragleave','target','Cancel','Letzte\x20löschen','3717276YfLhIG','mode-','mouseleave','src','toast\x20','View','strokeStyle','5cCLVTU','upload-hint','Dunkles\x20Design\x20aktivieren','slice','Mit\x20Kamera\x20fotografieren','light','btn-clear-text','Datei\x20hochgeladen','option-camera-title','chat_','appendChild','innerWidth','https://openrouter.ai/api/v1/chat/completions','iframe','Chat\x20gelöscht','true','length','Photo\x20taken'];_0x5530=function(){return _0x3ac9a8;};return _0x5530();}function handleTouchStart(_0x10d547){const _0x5d09fe=_0x469e95;_0x10d547['preventDefault']();const _0x366712=_0x10d547[_0x5d09fe(0x1d6)][0x0],_0x4aa59c=new MouseEvent(_0x5d09fe(0x18a),{'clientX':_0x366712[_0x5d09fe(0x1b2)],'clientY':_0x366712['clientY']});_0x10d547[_0x5d09fe(0x1da)][_0x5d09fe(0xe6)](_0x4aa59c);}function handleTouchMove(_0x27e34e){const _0x33762a=_0x469e95;_0x27e34e[_0x33762a(0x18e)]();const _0x307baf=_0x27e34e[_0x33762a(0x1d6)][0x0],_0x512894=new MouseEvent(_0x33762a(0xec),{'clientX':_0x307baf[_0x33762a(0x1b2)],'clientY':_0x307baf[_0x33762a(0x1b6)]});_0x27e34e[_0x33762a(0x1da)]['dispatchEvent'](_0x512894);}function handleRightClick(_0x4aa9da){const _0x1a1c02=_0x469e95;_0x4aa9da[_0x1a1c02(0x18e)]();const _0x4df7a5=document['getElementById'](_0x1a1c02(0x1ab)),_0x9f3eb=_0x4df7a5[_0x1a1c02(0x13a)](),_0x1810bb=_0x4df7a5['width']/_0x9f3eb[_0x1a1c02(0x12f)],_0x369bda=_0x4df7a5[_0x1a1c02(0x1bd)]/_0x9f3eb[_0x1a1c02(0x1bd)],_0xe737ed=(_0x4aa9da[_0x1a1c02(0x1b2)]-_0x9f3eb[_0x1a1c02(0x1d3)])*_0x1810bb,_0x1a688f=(_0x4aa9da[_0x1a1c02(0x1b6)]-_0x9f3eb['top'])*_0x369bda;for(let _0x2bf54f=markedAreas[_0x1a1c02(0x1f4)]-0x1;_0x2bf54f>=0x0;_0x2bf54f--){const _0x565cf8=markedAreas[_0x2bf54f];if(_0xe737ed>=_0x565cf8['x']&&_0xe737ed<=_0x565cf8['x']+_0x565cf8[_0x1a1c02(0x12f)]&&_0x1a688f>=_0x565cf8['y']&&_0x1a688f<=_0x565cf8['y']+_0x565cf8[_0x1a1c02(0x1bd)]){markedAreas[_0x1a1c02(0x122)](_0x2bf54f,0x1),updateMarkerCount(),redrawCanvas();break;}}}function clearLastMarker(){const _0x4c0590=_0x469e95;markedAreas[_0x4c0590(0x1f4)]>0x0&&(markedAreas['pop'](),updateMarkerCount(),redrawCanvas());}function clearAllMarkers(){markedAreas=[],updateMarkerCount(),redrawCanvas();}function updateMarkerCount(){const _0x256911=_0x469e95;document[_0x256911(0x1ff)]('marker-count')[_0x256911(0x1a5)]=markedAreas[_0x256911(0x1f4)];const _0x5b5c02=document[_0x256911(0x1ff)](_0x256911(0xfd)),_0x12d8a2=document[_0x256911(0x1ff)](_0x256911(0x136));markedAreas[_0x256911(0x1f4)]>0x0?(_0x5b5c02[_0x256911(0x1fc)][_0x256911(0xf6)](_0x256911(0x101)),_0x12d8a2['classList'][_0x256911(0xf6)](_0x256911(0x101))):(_0x5b5c02['classList'][_0x256911(0x130)](_0x256911(0x101)),_0x12d8a2[_0x256911(0x1fc)][_0x256911(0x130)](_0x256911(0x101)));}async function completeWorksheet(){const _0x15133a=_0x469e95,_0x4338f2=translations[currentLang];if(!uploadedFile){alert(_0x4338f2[_0x15133a(0x120)]);return;}let _0x21b7ee='';if(currentMode===_0x15133a(0x154)){const _0x454be2=document[_0x15133a(0x1ff)](_0x15133a(0xe3))[_0x15133a(0x115)][_0x15133a(0x1b0)]();if(!_0x454be2){alert(_0x4338f2['noSelection']);return;}_0x21b7ee=_0x454be2;}else{if(currentMode==='marker'){if(markedAreas['length']===0x0){alert(_0x4338f2[_0x15133a(0x1ce)]);return;}_0x21b7ee=_0x15133a(0x14d);}}showLoadingModal();try{const _0x576291=_0x15133a(0xe8),_0x4534da=_0x15133a(0x102);let _0x34485a=currentLang==='de'?_0x15133a(0x13b)+_0x21b7ee+'\x0a\x0aFORMATIERUNG:\x0a-\x20Verwende\x20EXAKTE\x20Nummerierung\x20vom\x20Arbeitsblatt\x0a-\x20Format:\x20\x22Aufgabe\x201)\x20a)\x20b)\x22\x20oder\x20\x221.\x202.\x203.\x22\x0a-\x20NUR\x20direkte\x20Antworten\x20-\x20KEINE\x20Erklärungen\x0a-\x20KEINE\x20Einleitungssätze\x0a-\x20Übernimm\x20Aufgabenstruktur\x20präzise\x0a\x0aBEISPIEL:\x0aArbeitsblatt:\x20\x22Aufgabe\x201)\x20a)\x205+3?\x20b)\x2010-4?\x22\x0aAntwort:\x20\x22Aufgabe\x201)\x20a)\x208\x20b)\x206\x22':_0x15133a(0x103)+_0x21b7ee+_0x15133a(0x137);const _0x427852=await fetch(_0x15133a(0x1f0),{'method':_0x15133a(0x183),'headers':{'Authorization':'Bearer\x20'+_0x576291,'Content-Type':_0x15133a(0x18d),'HTTP-Referer':window['location'][_0x15133a(0x1fd)],'X-Title':'Worksheet\x20Completer\x20Pro'},'body':JSON[_0x15133a(0x14a)]({'model':_0x4534da,'messages':[{'role':_0x15133a(0x1ac),'content':[{'type':_0x15133a(0x135),'text':_0x34485a},{'type':_0x15133a(0x133),'image_url':{'url':uploadedFileBase64}}]}],'temperature':0.2})});if(!_0x427852['ok'])throw new Error('API\x20request\x20failed');const _0x3528b8=await _0x427852[_0x15133a(0x14b)](),_0x5bc141=_0x3528b8[_0x15133a(0x177)][0x0]['message'][_0x15133a(0x11e)],_0x150cb2={'id':currentChatId,'filename':uploadedFile['name'],'date':new Date()[_0x15133a(0x159)](),'tasks':_0x21b7ee,'result':_0x5bc141,'fileBase64':uploadedFileBase64,'fileType':uploadedFileType},_0x11a992=chatHistory[_0x15133a(0x109)](_0x435468=>_0x435468['id']===currentChatId);_0x11a992>=0x0?chatHistory[_0x11a992]=_0x150cb2:chatHistory[_0x15133a(0x1f7)](_0x150cb2),chatHistory[_0x15133a(0x1f4)]>0x32&&(chatHistory=chatHistory[_0x15133a(0x1e7)](0x0,0x32)),saveChatHistory(),showResultModal(_0x5bc141,uploadedFileBase64,uploadedFileType,uploadedFile[_0x15133a(0x150)]);}catch(_0x142139){console['error'](_0x15133a(0x1d1),_0x142139),closeModal(),showToast(_0x4338f2[_0x15133a(0x129)],'error');}}function _0x5389(_0x2e1054,_0x428c70){const _0x5530eb=_0x5530();return _0x5389=function(_0x5389c8,_0x327aaa){_0x5389c8=_0x5389c8-0xd5;let _0x15bdfe=_0x5530eb[_0x5389c8];return _0x15bdfe;},_0x5389(_0x2e1054,_0x428c70);}function fileToBase64(_0x321dbb){return new Promise((_0x767029,_0x1d438b)=>{const _0x21b70d=_0x5389,_0x531455=new FileReader();_0x531455[_0x21b70d(0x17e)]=()=>_0x767029(_0x531455[_0x21b70d(0x10b)]),_0x531455['onerror']=_0x1d438b,_0x531455['readAsDataURL'](_0x321dbb);});}function showLoadingModal(){const _0xad41d3=_0x469e95,_0x3440ea=translations[currentLang],_0x2d1196=document[_0xad41d3(0x1ff)]('modal'),_0x5d6fcc=document['getElementById'](_0xad41d3(0x19f));_0x5d6fcc[_0xad41d3(0x1fe)]=_0xad41d3(0x189)+_0x3440ea['loadingText']+_0xad41d3(0x12d),_0x2d1196['classList'][_0xad41d3(0xf6)](_0xad41d3(0x101));}function showResultModal(_0x22c86e,_0x1f2c73,_0x1c8687,_0x215ad6){const _0x341e17=_0x469e95,_0x529d77=translations[currentLang],_0x4e327b=document[_0x341e17(0x1ff)]('modal'),_0x530d64=document[_0x341e17(0x1ff)](_0x341e17(0x19f));let _0x4ee5b5='';if(_0x1f2c73&&_0x1c8687){if(_0x1c8687[_0x341e17(0x174)](_0x341e17(0x1d2)))_0x4ee5b5=_0x341e17(0x1fb)+_0x1f2c73+_0x341e17(0x126)+(_0x215ad6||_0x341e17(0x195))+'\x22>';else _0x1c8687===_0x341e17(0x16a)&&(_0x4ee5b5=_0x341e17(0x198)+_0x1f2c73+_0x341e17(0x107));}else _0x4ee5b5=_0x341e17(0x19b);_0x530d64['innerHTML']=_0x341e17(0x164)+_0x529d77[_0x341e17(0x146)]+_0x341e17(0x1b3)+_0x4ee5b5+_0x341e17(0x1ae)+_0x529d77[_0x341e17(0x111)]+_0x341e17(0x176)+(_0x22c86e||_0x341e17(0x1f8))+_0x341e17(0xfa),_0x4e327b[_0x341e17(0x1fc)][_0x341e17(0xf6)](_0x341e17(0x101));}function closeModal(){const _0x1d8846=_0x469e95;document[_0x1d8846(0x1ff)](_0x1d8846(0x166))['classList'][_0x1d8846(0x130)](_0x1d8846(0x101));}document[_0x469e95(0x1ff)](_0x469e95(0x166))['addEventListener']('click',_0xe693f2=>{const _0x3f4d5d=_0x469e95;_0xe693f2[_0x3f4d5d(0x1da)]===document[_0x3f4d5d(0x1ff)](_0x3f4d5d(0x166))&&closeModal();});function openSettings(){const _0x434a91=_0x469e95,_0x167388=translations[currentLang],_0x540d44=document[_0x434a91(0x1ff)]('modal'),_0x33e8de=document['getElementById'](_0x434a91(0x19f));_0x33e8de['innerHTML']=_0x434a91(0x1d0)+_0x167388[_0x434a91(0x188)]+_0x434a91(0x173)+_0x167388[_0x434a91(0xfe)]+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22setting-desc\x22>'+_0x167388[_0x434a91(0xee)]+_0x434a91(0x165)+(darkMode?_0x434a91(0x1d8):'')+'\x20onchange=\x22toggleDarkMode()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22toggle-slider\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x540d44[_0x434a91(0x1fc)]['add'](_0x434a91(0x101));}function showToast(_0x2dac84,_0x1a24ae=_0x469e95(0x1c1)){const _0x368bf6=_0x469e95,_0x4eb291=document[_0x368bf6(0x140)](_0x368bf6(0x1bf));_0x4eb291[_0x368bf6(0x11f)]=_0x368bf6(0x1e1)+_0x1a24ae,_0x4eb291[_0x368bf6(0x1fe)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+(_0x1a24ae===_0x368bf6(0x18b)?'✅':_0x1a24ae===_0x368bf6(0x13f)?'❌':'ℹ️')+_0x368bf6(0xf2)+_0x2dac84+_0x368bf6(0x18f),document[_0x368bf6(0x158)]['appendChild'](_0x4eb291),setTimeout(()=>{const _0x53e4c5=_0x368bf6;_0x4eb291[_0x53e4c5(0x1b5)][_0x53e4c5(0x181)]=_0x53e4c5(0x15d),setTimeout(()=>_0x4eb291[_0x53e4c5(0x130)](),0x12c);},0xbb8);}init();
    </script>
</body>
</html>
